#!/usr/bin/perl
$bnk="";
if( $ARGV[0] eq '-h' || $ARGV[0] eq '-help' || $ARGV[0] eq '--help')
{
help();
exit;
}
sub help {
    print "\n=== orca_extract_grad - ORCA Gradient Extraction ===\n\n";
    print "PURPOSE:\n";
    print "  Extract gradients from ORCA .engrad files.\n";
    print "  Specialized parser for ORCA's gradient file format.\n\n";
    print "USAGE:\n";
    print "  orca_extract_grad name.engrad\n";
    print "  orca_extract_grad molecule.engrad > orca_gradients.dat\n\n";
    print "PARAMETERS:\n";
    print "  name.engrad - ORCA .engrad files (gradient files generated by ORCA)\n\n";
    print "INPUT:\n";
    print "  - ORCA .engrad files (gradient files generated by ORCA)\n";
    print "  - Standard ORCA gradient file format with header information\n\n";
    print "OUTPUT:\n";
    print "  - Gradients written to stdout\n";
    print "  - Format: gx gy gz (one line per atom)\n\n";
    print "DETAILS:\n";
    print "  - Specialized parser for ORCA's .engrad file format\n";
    print "  - Skips header information automatically\n";
    print "  - Reads three gradient components per atom (x, y, z)\n";
    print "  - Processes exactly the number of atoms specified in header\n";
    print "  - More reliable than parsing main ORCA output files\n\n";
    print "ENGRAD FILE FORMAT:\n";
    print "  - ORCA's standard gradient file format\n";
    print "  - Contains header with atom count and calculation info\n";
    print "  - Three lines per atom: gx, gy, gz components\n";
    print "  - Generated automatically by ORCA calculations\n\n";
    print "EXAMPLES:\n";
    print "  orca_extract_grad molecule.engrad > orca_gradients.dat\n";
    print "  orca_extract_grad qm_calc.engrad | ref_upd_orca_grad /dev/stdin system.ref > updated.ref\n\n";
    print "TYPICAL WORKFLOW:\n";
    print "  1. Run ORCA calculation: orca input.inp > output.out\n";
    print "  2. Extract gradients: orca_extract_grad molecule.engrad > gradients.dat\n";
    print "  3. Add to .ref file: ref_upd_orca_grad gradients.dat system.ref > final.ref\n\n";
    print "NOTE:\n";
    print "  - Most users should use ref_upd_orca_grad directly with .engrad files\n";
    print "  - This script is mainly for intermediate processing or debugging\n\n";
    print "SEE ALSO:\n";
    print "  ref_upd_orca_grad - Add ORCA gradients directly from .engrad files\n\n";
}

do ($_=<>) until ($.>2);  # skip the header
$natms=<>; chomp($natms);
do ($_=<>) until ($.>10); #skip the header  

while(<>) {
chomp;
$gx=$_; 
$_=<>; chomp; $gy=$_;
$_=<>; chomp; $gz=$_;
print $gx.$bnk.$gy.$bnk.$gz."\n";
$natms--;
last if $natms==0;
}






